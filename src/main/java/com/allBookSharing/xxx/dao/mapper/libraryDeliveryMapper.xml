<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.allBookSharing.xxx.dao.ILibraryDeliveryDao">

<select id="getDeliveryList" resultType="LibraryDelivery">
SELECT distinct BO_NUM,BO_ID,BD_STATE_NUM,BD_DATE 
FROM BORROWLIST JOIN BORROWDETAIL 
ON BO_NUM=BD_BO_NUM
JOIN BOOKS ON BK_CODE=BD_BCODE
WHERE BD_LCODE=#{lb_code} AND BD_STATE_NUM !=3
	
	</select>
	
	
<select  id="getLbDeliveryDetail" resultType="librarydelivery">
SELECT *
FROM BORROWLIST JOIN BORROWDETAIL 
ON BO_NUM=BD_BO_NUM
JOIN BOOKS ON BK_CODE=bd_bcode AND BK_LCODE=BD_LCODE
WHERE BD_LCODE=#{bd_lcode} AND BO_NUM=#{bo_num}

</select>
	
<update id="lbDeliveryCancel" parameterType="librarydelivery">

UPDATE BORROWDETAIL SET BD_STATE_NUM=3,BD_REASON=#{bd_reason} WHERE BD_NUM=#{bd_num}

</update>	


<update id="lbDeliveryComplete" parameterType="librarydelivery">

UPDATE BORROWDETAIL SET BD_STATE_NUM=4 WHERE BD_BO_NUM=#{bo_num} AND BD_STATE_NUM!=3

</update>	
	
</mapper>